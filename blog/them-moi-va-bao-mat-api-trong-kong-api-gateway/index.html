<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Thêm mới và bảo mật API trong Kong API Gateway | HuyDQ's Blog</title><meta name=keywords content="API Gateway"><meta name=description content="Kong cung cấp một RESTful Admin API cho phép chúng ta thực hiện việc cấu hình và quản lý các API. Mặc định Admin API sẽ lắng nghe ở cổng 8001 và cổng 8444 cho giao thức https. Chú ý API này chỉ dùng trong nội bộ, không public ra ngoài, vì nó cho phép quản lý toàn bộ hệ thống API gateway của Kong.
Để dễ hình dung, bài viết này sẽ hướng dẫn tạo mới các API và bảo mật cơ bản bằng plugins sử dụng Konga (GUI cho Admin API)."><meta name=author content><link rel=canonical href=https://huydq.dev/blog/them-moi-va-bao-mat-api-trong-kong-api-gateway/><link crossorigin=anonymous href=/assets/css/stylesheet.03fdbd40523cb3f4c70fd773f9652c3a49098f4b3ec0af3be47c955612757bf8.css integrity="sha256-A/29QFI8s/THD9dz+WUsOkkJj0s+wK875HyVVhJ1e/g=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://huydq.dev/icons/favicon.png><link rel=icon type=image/png sizes=16x16 href=https://huydq.dev/icons/favicon16.png><link rel=icon type=image/png sizes=32x32 href=https://huydq.dev/icons/favicon32.png><link rel=apple-touch-icon href=https://huydq.dev/icons/favicon.png><link rel=mask-icon href=https://huydq.dev/icons/favicon.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-5KF148C0X6"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-5KF148C0X6",{anonymize_ip:!1})}</script><meta property="og:title" content="Thêm mới và bảo mật API trong Kong API Gateway"><meta property="og:description" content="Kong cung cấp một RESTful Admin API cho phép chúng ta thực hiện việc cấu hình và quản lý các API. Mặc định Admin API sẽ lắng nghe ở cổng 8001 và cổng 8444 cho giao thức https. Chú ý API này chỉ dùng trong nội bộ, không public ra ngoài, vì nó cho phép quản lý toàn bộ hệ thống API gateway của Kong.
Để dễ hình dung, bài viết này sẽ hướng dẫn tạo mới các API và bảo mật cơ bản bằng plugins sử dụng Konga (GUI cho Admin API)."><meta property="og:type" content="article"><meta property="og:url" content="https://huydq.dev/blog/them-moi-va-bao-mat-api-trong-kong-api-gateway/"><meta property="og:image" content="https://huydq.dev/icons/avatar.png"><meta property="article:section" content="blog"><meta property="article:published_time" content="2018-03-05T00:00:00+00:00"><meta property="article:modified_time" content="2018-03-05T00:00:00+00:00"><meta property="og:site_name" content="HuyDQ's Blog"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://huydq.dev/icons/avatar.png"><meta name=twitter:title content="Thêm mới và bảo mật API trong Kong API Gateway"><meta name=twitter:description content="Kong cung cấp một RESTful Admin API cho phép chúng ta thực hiện việc cấu hình và quản lý các API. Mặc định Admin API sẽ lắng nghe ở cổng 8001 và cổng 8444 cho giao thức https. Chú ý API này chỉ dùng trong nội bộ, không public ra ngoài, vì nó cho phép quản lý toàn bộ hệ thống API gateway của Kong.
Để dễ hình dung, bài viết này sẽ hướng dẫn tạo mới các API và bảo mật cơ bản bằng plugins sử dụng Konga (GUI cho Admin API)."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Thêm mới và bảo mật API trong Kong API Gateway","item":"https://huydq.dev/blog/them-moi-va-bao-mat-api-trong-kong-api-gateway/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Thêm mới và bảo mật API trong Kong API Gateway","name":"Thêm mới và bảo mật API trong Kong API Gateway","description":"Kong cung cấp một RESTful Admin API cho phép chúng ta thực hiện việc cấu hình và quản lý các API. Mặc định Admin API sẽ lắng nghe ở cổng 8001 và cổng 8444 cho giao thức https. Chú ý API này chỉ dùng trong nội bộ, không public ra ngoài, vì nó cho phép quản lý toàn bộ hệ thống API gateway của Kong.\nĐể dễ hình dung, bài viết này sẽ hướng dẫn tạo mới các API và bảo mật cơ bản bằng plugins sử dụng Konga (GUI cho Admin API).","keywords":["API Gateway"],"articleBody":"Kong cung cấp một RESTful Admin API cho phép chúng ta thực hiện việc cấu hình và quản lý các API. Mặc định Admin API sẽ lắng nghe ở cổng 8001 và cổng 8444 cho giao thức https. Chú ý API này chỉ dùng trong nội bộ, không public ra ngoài, vì nó cho phép quản lý toàn bộ hệ thống API gateway của Kong.\nĐể dễ hình dung, bài viết này sẽ hướng dẫn tạo mới các API và bảo mật cơ bản bằng plugins sử dụng Konga (GUI cho Admin API). Tuy nhiên các bạn có thể dùng curl hay Postman để test. Tài liệu tham khảo: Danh sách các endpoint và tham số của Kong Admin API.\nSau khi cài đặt và đăng nhập vào Konga, chúng ta sẽ kết nối Konga với Kong Admin API (chú ý Active connection):\nThêm mới API Endpoint: Add API\nCác tham số cần thiết:\n name: Tên của API (sử dụng để quản lý API). Ngoài name ra cũng thể dùng id để quản lý API (do hệ thống tự tạo). hosts, uris, methods: Dùng để phân biệt giữa các API, luôn phải có ít nhất 1 trong 3 thuộc tính này. Hosts là phân biệt qua Headers của request, uris là phân biệt qua đường dẫn và methods là phân biệt qua phương thức của request. upstream_url: Đường dẫn gốc của API.    Ví dụ thêm API trỏ đến techmaster.vn qua đường dẫn /techmaster   Các API sẽ chạy qua cổng 8000, trong ví dụ này chúng ta chạy trên localhost nên sẽ truy cập vào localhost:8000. Với cấu hình như ví dụ trên thì khi chúng ta truy cập vào localhost:8000/techmaster, Kong sẽ forward sang trang techmaster.vn. Tuy nhiên đường dẫn một số file như css sẽ bị sai do đường dẫn không bắt đầu từ tên domain (đường dẫn gốc). Do đó nếu sử dụng đường dẫn để phân biệt API thì với ứng dụng web frontend nên dùng cho đường dẫn gốc là /.\nCấu hình plugins Để bảo mật API, chúng ta sẽ cấu hình thêm một số plugins của Kong. Ví dụ để Authentication chúng ta có thể dùng một số plugins như: Basic Authentication, Key Authentication, JWT, … (một số plugins có nhãn Enterprise sẽ phải trả phí để sử dụng).\nPlugins có thể áp dụng cho toàn bộ API hoặc cho cụ thể từng API qua name hoặc id của chúng. Endpoint Add Plugin.\nVí dụ cấu hình plugin Basic Authentication:\nSau khi kích hoạt Plugin, để truy cập được vào API chúng ta sẽ phải qua một bước Authentication của browser: Nếu user nhập đúng Username và Password thì mới truy cập được vào API. Nếu là gửi request thì trong Headers của request phải có thuộc tính Proxy-Authorization hoặc Authorization có chứa Username và Password được mã hóa base64 theo cú pháp Username:Password.\nTạo Consumer Bước thiếp theo chúng ta phải tạo Consumer để truy cập API. Endpoint Create Consumer.\nTrong Consumer, chúng ta tạo thêm các Credentials tương ứng với các tài khoản truy cập cho Authentication:\nVậy là chúng ta đã cấu hình xong Basic Authentication cho API. Với các Plugins khác thì cũng làm tương tự.\n","wordCount":"536","inLanguage":"en","datePublished":"2018-03-05T00:00:00Z","dateModified":"2018-03-05T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://huydq.dev/blog/them-moi-va-bao-mat-api-trong-kong-api-gateway/"},"publisher":{"@type":"Organization","name":"HuyDQ's Blog","logo":{"@type":"ImageObject","url":"https://huydq.dev/icons/favicon.png"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://huydq.dev/ accesskey=h title="huydq.dev (Alt + H)">huydq.dev</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://huydq.dev/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://huydq.dev/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://huydq.dev/projects/ title=Projects><span>Projects</span></a></li><li><a href=https://huydq.dev/about/ title=About><span>About</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Thêm mới và bảo mật API trong Kong API Gateway</h1><div class=post-meta><span title="2018-03-05 00:00:00 +0000 UTC">05/03/2018</span>&nbsp;·&nbsp;3 min</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#thêm-mới-api>Thêm mới API</a></li><li><a href=#cấu-hình-plugins>Cấu hình plugins</a></li><li><a href=#tạo-consumer>Tạo Consumer</a></li></ul></nav></div></details></div><div class=post-content><p>Kong cung cấp một <em>RESTful Admin API</em> cho phép chúng ta thực hiện việc cấu hình và quản lý các API. Mặc định Admin API sẽ lắng nghe ở cổng <strong>8001</strong> và cổng <strong>8444</strong> cho giao thức <em>https</em>. Chú ý API này chỉ dùng trong nội bộ, không public ra ngoài, vì nó cho phép quản lý toàn bộ hệ thống API gateway của Kong.</p><p>Để dễ hình dung, bài viết này sẽ hướng dẫn tạo mới các API và bảo mật cơ bản bằng plugins sử dụng <a href=https://github.com/pantsel/konga>Konga</a> (GUI cho Admin API). Tuy nhiên các bạn có thể dùng <strong>curl</strong> hay <strong>Postman</strong> để test. Tài liệu tham khảo: Danh sách các endpoint và tham số của <a href=https://getkong.org/docs/0.12.x/admin-api/>Kong Admin API</a>.</p><p>Sau khi cài đặt và đăng nhập vào Konga, chúng ta sẽ kết nối Konga với Kong Admin API (chú ý Active connection):</p><p><img loading=lazy src=/images/kong-active-connection.png alt="Add connections"></p><h2 id=thêm-mới-api>Thêm mới API<a hidden class=anchor aria-hidden=true href=#thêm-mới-api>#</a></h2><p><em>Endpoint: <a href=https://getkong.org/docs/0.12.x/admin-api/#add-api>Add API</a></em></p><p><img loading=lazy src=/images/kong-api.png alt="Add API"></p><p>Các tham số cần thiết:</p><ul><li><strong>name</strong>: Tên của API (sử dụng để quản lý API). Ngoài name ra cũng thể dùng id để quản lý API (do hệ thống tự tạo).</li><li><strong>hosts</strong>, <strong>uris</strong>, <strong>methods</strong>: Dùng để phân biệt giữa các API, luôn phải có ít nhất 1 trong 3 thuộc tính này. Hosts là phân biệt qua Headers của request, uris là phân biệt qua đường dẫn và methods là phân biệt qua phương thức của request.</li><li><strong>upstream_url</strong>: Đường dẫn gốc của API.</li></ul><figure><img loading=lazy src=/images/kong-add-api.png alt="Add API"><figcaption>Ví dụ thêm API trỏ đến techmaster.vn qua đường dẫn /techmaster</figcaption></figure><p>Các API sẽ chạy qua cổng <strong>8000</strong>, trong ví dụ này chúng ta chạy trên localhost nên sẽ truy cập vào <em>localhost:8000</em>. Với cấu hình như ví dụ trên thì khi chúng ta truy cập vào <em>localhost:8000/techmaster</em>, Kong sẽ forward sang trang <em>techmaster.vn.</em> Tuy nhiên đường dẫn một số file như <em>css</em> sẽ bị sai do đường dẫn không bắt đầu từ tên domain (đường dẫn gốc). Do đó nếu sử dụng đường dẫn để phân biệt API thì với ứng dụng web frontend nên dùng cho đường dẫn gốc là <strong>/</strong>.</p><h2 id=cấu-hình-plugins>Cấu hình plugins<a hidden class=anchor aria-hidden=true href=#cấu-hình-plugins>#</a></h2><p>Để bảo mật API, chúng ta sẽ cấu hình thêm một số <a href=https://konghq.com/plugins/>plugins</a> của Kong. Ví dụ để Authentication chúng ta có thể dùng một số plugins như: Basic Authentication, Key Authentication, JWT, &mldr; (một số plugins có nhãn Enterprise sẽ phải trả phí để sử dụng).</p><p>Plugins có thể áp dụng cho toàn bộ API hoặc cho cụ thể từng API qua name hoặc id của chúng. Endpoint <a href=https://getkong.org/docs/0.12.x/admin-api/#add-plugin>Add Plugin</a>.</p><p>Ví dụ cấu hình plugin <a href="https://getkong.org/plugins/basic-authentication/?_ga=2.66688302.125727870.1520222260-2127029264.1519895628">Basic Authentication</a>:</p><p><img loading=lazy src=/images/kong-add-plugin.png alt="Add plugin"></p><p>Sau khi kích hoạt Plugin, để truy cập được vào API chúng ta sẽ phải qua một bước Authentication của browser: 
<img loading=lazy src=/images/basic-authentication.png alt="Basic authentication"></p><p>Nếu user nhập đúng Username và Password thì mới truy cập được vào API. Nếu là gửi request thì trong Headers của request phải có thuộc tính Proxy-Authorization hoặc Authorization có chứa Username và Password được mã hóa base64 theo cú pháp Username:Password.</p><h2 id=tạo-consumer>Tạo Consumer<a hidden class=anchor aria-hidden=true href=#tạo-consumer>#</a></h2><p>Bước thiếp theo chúng ta phải tạo Consumer để truy cập API. Endpoint <a href=https://getkong.org/docs/0.12.x/admin-api/#create-consumer>Create Consumer</a>.</p><p><img loading=lazy src=/images/kong-add-consumer.png alt="Add consumer"></p><p>Trong Consumer, chúng ta tạo thêm các Credentials tương ứng với các tài khoản truy cập cho Authentication:</p><p><img loading=lazy src=/images/kong-create-credentials.png alt="Create Credentials"></p><p>Vậy là chúng ta đã cấu hình xong Basic Authentication cho API. Với các Plugins khác thì cũng làm tương tự.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://huydq.dev/tags/api-gateway/>API Gateway</a></li></ul><nav class=paginav><a class=prev href=https://huydq.dev/blog/hoc-go-cap-toc-phan-1-packages-variables-va-functions/><span class=title>« Prev</span><br><span>Học Go cấp tốc Phần 1: Packages, variables và functions</span></a>
<a class=next href=https://huydq.dev/blog/tuy-chinh-visual-studio-code-khi-lap-trinh-aspnet-core/><span class=title>Next »</span><br><span>Tùy chỉnh Visual Studio Code khi lập trình ASP.NET Core</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share Thêm mới và bảo mật API trong Kong API Gateway on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fhuydq.dev%2fblog%2fthem-moi-va-bao-mat-api-trong-kong-api-gateway%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Thêm mới và bảo mật API trong Kong API Gateway on twitter" href="https://twitter.com/intent/tweet/?text=Th%c3%aam%20m%e1%bb%9bi%20v%c3%a0%20b%e1%ba%a3o%20m%e1%ba%adt%20API%20trong%20Kong%20API%20Gateway&url=https%3a%2f%2fhuydq.dev%2fblog%2fthem-moi-va-bao-mat-api-trong-kong-api-gateway%2f&hashtags=APIGateway"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a></div></footer><div id=disqus_thread></div><script type=text/javascript>(function(){if(window.location.hostname=="localhost")return;var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="//huydq-dev.disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)})()</script><noscript>Please enable JavaScript to view the
<a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript></article></main><footer class=footer><span>&copy; 2022 HuyDQ's Blog</span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(t){t.preventDefault();var e=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView({behavior:"smooth"}),e==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${e}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(t=>{const n=t.parentNode.parentNode,e=document.createElement("button");e.classList.add("copy-code"),e.innerHTML="copy";function s(){e.innerHTML="copied!",setTimeout(()=>{e.innerHTML="copy"},2e3)}e.addEventListener("click",o=>{if("clipboard"in navigator){navigator.clipboard.writeText(t.textContent),s();return}const e=document.createRange();e.selectNodeContents(t);const n=window.getSelection();n.removeAllRanges(),n.addRange(e);try{document.execCommand("copy"),s()}catch(e){}n.removeRange(e)}),n.classList.contains("highlight")?n.appendChild(e):n.parentNode.firstChild==n||(t.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?t.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(e):t.parentNode.appendChild(e))})</script></body></html>