<!doctype html><html lang=en dir=auto>
<head><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=robots content="index, follow">
<title>Hướng dẫn sử dụng RTK Query trong Redux Toolkit | HuyDQ's Blog</title>
<meta name=keywords content="ReactJS,Redux Toolkit">
<meta name=description content="RTK Query là một addon trong bộ thư viện Redux Toolkit. Nó giúp chúng ta thực hiện data fetching một cách đơn giản hơn thay vì sử dụng createAsyncThunk để thực hiện async action. Chú ý RTK Query là dùng để query (kết nối API), chứ không phải dùng để code async trong Redux thay cho createAsyncThunk.
Nếu bạn chưa từng sử dụng Redux Toolkit thì có thể xem bài hướng dẫn này trước: Hướng dẫn sử dụng React Router và Redux Toolkit.">
<meta name=author content>
<link rel=canonical href=https://huydq.dev/blog/huong-dan-su-dung-rtk-query-trong-redux-toolkit/>
<link crossorigin=anonymous href=/assets/css/stylesheet.b1eb50b50e11910be36d25969ce9605fa6614a089f514914206a6cd4c0553a07.css rel="preload stylesheet" as=style>
<script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://huydq.dev/icons/favicon.png>
<link rel=icon type=image/png sizes=16x16 href=https://huydq.dev/icons/favicon16.png>
<link rel=icon type=image/png sizes=32x32 href=https://huydq.dev/icons/favicon32.png>
<link rel=apple-touch-icon href=https://huydq.dev/icons/favicon.png>
<link rel=mask-icon href=https://huydq.dev/icons/favicon.png>
<meta name=theme-color content="#2e2e33">
<meta name=msapplication-TileColor content="#2e2e33">
<noscript>
<style>#theme-toggle,.top-link{display:none}</style>
<style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style>
</noscript>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-5KF148C0X6"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-5KF148C0X6',{anonymize_ip:!1})}</script>
<meta property="og:title" content="Hướng dẫn sử dụng RTK Query trong Redux Toolkit">
<meta property="og:description" content="RTK Query là một addon trong bộ thư viện Redux Toolkit. Nó giúp chúng ta thực hiện data fetching một cách đơn giản hơn thay vì sử dụng createAsyncThunk để thực hiện async action. Chú ý RTK Query là dùng để query (kết nối API), chứ không phải dùng để code async trong Redux thay cho createAsyncThunk.
Nếu bạn chưa từng sử dụng Redux Toolkit thì có thể xem bài hướng dẫn này trước: Hướng dẫn sử dụng React Router và Redux Toolkit.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://huydq.dev/blog/huong-dan-su-dung-rtk-query-trong-redux-toolkit/"><meta property="og:image" content="https://huydq.dev/icons/thumbnail.jpg"><meta property="article:section" content="blog">
<meta property="article:published_time" content="2021-10-13T00:00:00+00:00">
<meta property="article:modified_time" content="2021-10-13T00:00:00+00:00"><meta property="og:site_name" content="HuyDQ's Blog">
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="https://huydq.dev/icons/thumbnail.jpg">
<meta name=twitter:title content="Hướng dẫn sử dụng RTK Query trong Redux Toolkit">
<meta name=twitter:description content="RTK Query là một addon trong bộ thư viện Redux Toolkit. Nó giúp chúng ta thực hiện data fetching một cách đơn giản hơn thay vì sử dụng createAsyncThunk để thực hiện async action. Chú ý RTK Query là dùng để query (kết nối API), chứ không phải dùng để code async trong Redux thay cho createAsyncThunk.
Nếu bạn chưa từng sử dụng Redux Toolkit thì có thể xem bài hướng dẫn này trước: Hướng dẫn sử dụng React Router và Redux Toolkit.">
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Hướng dẫn sử dụng RTK Query trong Redux Toolkit","item":"https://huydq.dev/blog/huong-dan-su-dung-rtk-query-trong-redux-toolkit/"}]}</script>
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Hướng dẫn sử dụng RTK Query trong Redux Toolkit","name":"Hướng dẫn sử dụng RTK Query trong Redux Toolkit","description":"RTK Query là một addon trong bộ thư viện Redux Toolkit. Nó giúp chúng ta thực hiện data fetching một cách đơn giản hơn thay vì sử dụng createAsyncThunk để thực hiện async action. Chú ý RTK Query là dùng để query (kết nối API), chứ không phải dùng để code async trong Redux thay cho createAsyncThunk.\nNếu bạn chưa từng sử dụng Redux Toolkit thì có thể xem bài hướng dẫn này trước: Hướng dẫn sử dụng React Router và Redux Toolkit.","keywords":["ReactJS","Redux Toolkit"],"articleBody":"RTK Query là một addon trong bộ thư viện Redux Toolkit. Nó giúp chúng ta thực hiện data fetching một cách đơn giản hơn thay vì sử dụng createAsyncThunk để thực hiện async action. Chú ý RTK Query là dùng để query (kết nối API), chứ không phải dùng để code async trong Redux thay cho createAsyncThunk.\nNếu bạn chưa từng sử dụng Redux Toolkit thì có thể xem bài hướng dẫn này trước: Hướng dẫn sử dụng React Router và Redux Toolkit.\nCòn nếu chưa biết cách dùng createAsyncThunk thì xem bài hướng dẫn này: Hướng dẫn sử dụng createAsyncThunk trong Redux Toolkit.\nChúng ta sẽ tiếp tục sử dụng ví dụ này để demo: https://stackblitz.com/edit/react-router-redux-toolkit-fetch-api?file=src/App.js. Trong code mẫu này có sử dụng createAsyncThunk và fetch API để kết nối đến API. Chúng ta sẽ thay thế phần kết nối API bằng RTK Query.\nĐầu tiên chúng ta tạo 1 file mới, tương tự như tạo một slice, và file này sẽ dùng để khai báo các lệnh gọi API. Ví dụ trong thư mục store tạo thêm file api.js với nội dung như sau:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14  import { createApi, fetchBaseQuery } from \"@reduxjs/toolkit/query/react\"; export const api = createApi({ // Tương tự tên Slice khi tạo Slice thông thường  reducerPath: \"api\", // Cấu hình chung cho tất cả request  baseQuery: fetchBaseQuery({ baseUrl: \"https://fake-rest-api-nodejs.herokuapp.com/\", }), // Các endpoints (lệnh gọi request)  endpoints: (builder) = ({}), });   Nhúng API này vào trong store như một Slice, sửa file store/index.js:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17  import { configureStore } from \"@reduxjs/toolkit\"; import { api } from \"./api\"; import userReducer from \"./userSlice\"; export const store = configureStore({ reducer: { // Tạo thêm slice từ api  [api.reducerPath]: api.reducer, // Slice thông thường  user: userReducer, }, // Thêm cấu hình middleware để dùng được các chức năng của RTK Query như caching, invalidation, polling, ...  middleware: (getDefaultMiddleware) = getDefaultMiddleware().concat(api.middleware), });   Sau khi cấu hình xong, chúng ta có thể thêm các endpoint để thực hiện request đến API. Endpoint trong RTK Query phân làm 2 loại:\n Query: Dùng để lấy dữ liệu (có thể lưu cache). Mutation: Dùng để cập nhật dữ liệu (validate cache).  Với request login thì mình sẽ dùng loại mutation, sửa lại phần endpoints của file store/api.js:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21  export const api = createApi({ ... endpoints: (builder) = ({ // Tạo 1 request dạng mutation  login: builder.mutation({ query: (credentials) = ({ url: `login`, method: 'POST', body: credentials, }), }), getUsers: builder.query({ query: () = `users`, }), }), ... } // Export ra ngoài thành các hooks để sử dụng theo cú pháp use + endpoints (login) + endpoints type (mutation) export const { useLoginMutation } = api;   Sửa lại trang login, sử dụng mutation ở trên để gọi API:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20  ... // Import hook để sử dụng import { useLoginMutation } from '../store/api'; export default function Login() { // Sử dụng hook useLoginMutation sẽ trả về method login dùng để gọi request  // kèm theo 1 số trạng thái như loading, dữ liệu hoặc lỗi trả về khi gọi request  const [login, { isLoading, data, error }] = useLoginMutation(); ... return (  ... {/* Gọi login method lấy từ hook useLoginMutation() ở trên */} {/* Có thể sử dụng biến isLoading để hiển thị trạng thái loading thay cho state */} button onClick={() = login({ email, password })} disabled={isLoading} Login button  ); }   Như vậy việc gọi API sẽ trở nên dễ dàng hơn. Bạn cũng có thể sử dụng biến error để hiển thị báo lỗi trên giao diện.\nTrong trường hợp cần lưu dữ liệu vào trong store, ví dụ cập nhật state ở Slice khác thì làm tương tự như khi dùng createAsyncThunk. Sửa lại file store/userSlice.js để thêm logic lưu thông tin user sau khi user đăng nhập thành công:\n1 2 3 4 5 6 7  extraReducers: (builder) = { // Xử lý logic khi endpoint login được fulfilled  builder.addMatcher(api.endpoints.login.matchFulfilled, (state, action) = { // Lưu thông tin user vào state  state.currentUser = action.payload; }); },   Hoặc RTK Query cũng hỗ trợ lấy state từ Slice khác. Ví dụ sau khi login thành công thì các request đến private API cần có gửi thêm token. Chúng ta có thể lấy token từ trong userSlice (state currentUser).\nSửa lại hàm fetchBaseQuery() ở store/api.js để cho phép các request đều gửi kèm token nếu có:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17  baseQuery: fetchBaseQuery({ baseUrl: 'https://fake-rest-api-nodejs.herokuapp.com/', // Xử lý header trước khi gửi request  prepareHeaders: (headers, { getState }) = { // getState() giúp lấy ra toàn bộ state trong store  // getState().user lấy ra state trong userSlice  const token = getState().user.currentUser?.token; // Nếu có token thì thêm vào headers  if (token) { headers.set('Authorization', `Bearer ${token}`); } return headers; }, }),   Kiểm tra thử bằng cách tạo thêm 1 endpoint nữa để lấy ra danh sách user. Endpoint này là private và nếu không có token sẽ trả về lỗi 401. Bổ sung thêm endpoint getUsers vào file store/api.js:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15  export const api = createApi({ ... endpoints: (builder) = ({ login: builder.mutation(...), // Thêm endpoint dạng query  getUsers: builder.query({ query: () = `users`, }),  }), ... } // Export các hooks ra ngoài để sử dụng export const { useLoginMutation, useGetUsersQuery } = api;   Sửa lại nội dung trang Dashboard (sau khi login thành công) để hiển thị thông tin users lấy từ API:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29  ... import { useGetUsersQuery } from '../store/api'; export default function Dashboard() { // Sử dụng hook useGetUsersQuery để gọi API  const { data, isLoading, error } = useGetUsersQuery(); ... return (  ... h2User Listh2 {isLoading ? ( 'fetching data ...' ) : ( ul {data?.map((item) = ( li key={item.id} {item.firstName} {item.lastName} li ))} ul )}  ); }   Vậy là chúng ta đã làm xong một ứng dụng nhỏ sử dụng RTK Query cho việc fetching data. Addon này còn nhiều chức năng nữa như caching, prefetching, polling, code splitting, … các bạn hãy đọc thêm document trên trang chủ của thư viện để áp dụng vào dự án.\nTham khảo toàn bộ code mẫu tại đây: https://stackblitz.com/edit/react-router-redux-toolkit-fetch-api-2c64iz?file=src/App.js.\nHappy coding 😎\n","wordCount":"1135","inLanguage":"en","datePublished":"2021-10-13T00:00:00Z","dateModified":"2021-10-13T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://huydq.dev/blog/huong-dan-su-dung-rtk-query-trong-redux-toolkit/"},"publisher":{"@type":"Organization","name":"HuyDQ's Blog","logo":{"@type":"ImageObject","url":"https://huydq.dev/icons/favicon.png"}}}</script>
</head>
<body id=top>
<script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script>
<header class=header>
<nav class=nav>
<div class=logo>
<a href=https://huydq.dev/ accesskey=h title="huydq.dev (Alt + H)">huydq.dev</a>
<div class=logo-switches>
<button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</button>
</div>
</div>
<ul id=menu>
<li>
<a href=https://huydq.dev/search/ title="Search (Alt + /)" accesskey=/>
<span>Search</span>
</a>
</li>
<li>
<a href=https://huydq.dev/tags/ title=Tags>
<span>Tags</span>
</a>
</li>
<li>
<a href=https://huydq.dev/projects/ title=Projects>
<span>Projects</span>
</a>
</li>
<li>
<a href=https://huydq.dev/about/ title=About>
<span>About</span>
</a>
</li>
</ul>
</nav>
</header>
<main class=main>
<article class=post-single>
<header class=post-header>
<h1 class=post-title>
Hướng dẫn sử dụng RTK Query trong Redux Toolkit
</h1>
<div class=post-meta><span title="2021-10-13 00:00:00 +0000 UTC">13/10/2021</span>&nbsp;·&nbsp;6 min
</div>
</header>
<div class=post-content><p><a href=https://redux-toolkit.js.org/rtk-query/overview>RTK Query</a> là một addon trong bộ thư viện Redux Toolkit. Nó giúp chúng ta thực hiện data fetching một cách đơn giản hơn thay vì sử dụng <em>createAsyncThunk</em> để thực hiện async action. Chú ý RTK Query là dùng để <em>query</em> (kết nối API), chứ không phải dùng để code async trong Redux thay cho <em>createAsyncThunk</em>.</p>
<p>Nếu bạn chưa từng sử dụng Redux Toolkit thì có thể xem bài hướng dẫn này trước: <a href=/blog/huong-dan-su-dung-react-router-va-redux-toolkit>Hướng dẫn sử dụng React Router và Redux Toolkit</a>.</p>
<p>Còn nếu chưa biết cách dùng <em>createAsyncThunk</em> thì xem bài hướng dẫn này: <a href=/blog/huong-dan-su-dung-createasyncthunk-trong-redux-toolkit>Hướng dẫn sử dụng createAsyncThunk trong Redux Toolkit</a>.</p>
<p>Chúng ta sẽ tiếp tục sử dụng ví dụ này để demo: <a href="https://stackblitz.com/edit/react-router-redux-toolkit-fetch-api?file=src/App.js">https://stackblitz.com/edit/react-router-redux-toolkit-fetch-api?file=src/App.js</a>. Trong code mẫu này có sử dụng createAsyncThunk và fetch API để kết nối đến API. Chúng ta sẽ thay thế phần kết nối API bằng RTK Query.</p>
<p><img loading=lazy src=/images/redux-toolkit-login-form-demo.png alt="Login form sử dụng ReactJS + Redux Toolkit + RTK Query">
</p>
<p>Đầu tiên chúng ta tạo 1 file mới, tương tự như tạo một slice, và file này sẽ dùng để khai báo các lệnh gọi API. Ví dụ trong thư mục store tạo thêm file <strong>api.js</strong> với nội dung như sau:</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-react data-lang=react><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>createApi</span>, <span style=color:#a6e22e>fetchBaseQuery</span> } <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#34;@reduxjs/toolkit/query/react&#34;</span>;

<span style=color:#66d9ef>export</span> <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>api</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createApi</span>({
  <span style=color:#75715e>// Tương tự tên Slice khi tạo Slice thông thường
</span><span style=color:#75715e></span>  <span style=color:#a6e22e>reducerPath</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;api&#34;</span>,

  <span style=color:#75715e>// Cấu hình chung cho tất cả request
</span><span style=color:#75715e></span>  <span style=color:#a6e22e>baseQuery</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>fetchBaseQuery</span>({
    <span style=color:#a6e22e>baseUrl</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;https://fake-rest-api-nodejs.herokuapp.com/&#34;</span>,
  }),

  <span style=color:#75715e>// Các endpoints (lệnh gọi request)
</span><span style=color:#75715e></span>  <span style=color:#a6e22e>endpoints</span><span style=color:#f92672>:</span> (<span style=color:#a6e22e>builder</span>) =&gt; ({}),
});
</code></pre></td></tr></table>
</div>
</div><p>Nhúng API này vào trong store như một Slice, sửa file <code>store/index.js</code>:</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-react data-lang=react><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>configureStore</span> } <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#34;@reduxjs/toolkit&#34;</span>;
<span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>api</span> } <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#34;./api&#34;</span>;
<span style=color:#66d9ef>import</span> <span style=color:#a6e22e>userReducer</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#34;./userSlice&#34;</span>;

<span style=color:#66d9ef>export</span> <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>store</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>configureStore</span>({
  <span style=color:#a6e22e>reducer</span><span style=color:#f92672>:</span> {
    <span style=color:#75715e>// Tạo thêm slice từ api
</span><span style=color:#75715e></span>    [<span style=color:#a6e22e>api</span>.<span style=color:#a6e22e>reducerPath</span>]<span style=color:#f92672>:</span> <span style=color:#a6e22e>api</span>.<span style=color:#a6e22e>reducer</span>,

    <span style=color:#75715e>// Slice thông thường
</span><span style=color:#75715e></span>    <span style=color:#a6e22e>user</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>userReducer</span>,
  },

  <span style=color:#75715e>// Thêm cấu hình middleware để dùng được các chức năng của RTK Query như caching, invalidation, polling, ...
</span><span style=color:#75715e></span>  <span style=color:#a6e22e>middleware</span><span style=color:#f92672>:</span> (<span style=color:#a6e22e>getDefaultMiddleware</span>) =&gt;
    <span style=color:#a6e22e>getDefaultMiddleware</span>().<span style=color:#a6e22e>concat</span>(<span style=color:#a6e22e>api</span>.<span style=color:#a6e22e>middleware</span>),
});
</code></pre></td></tr></table>
</div>
</div><p>Sau khi cấu hình xong, chúng ta có thể thêm các endpoint để thực hiện request đến API. Endpoint trong RTK Query phân làm 2 loại:</p>
<ul>
<li><a href=https://redux-toolkit.js.org/rtk-query/usage/queries>Query</a>: Dùng để lấy dữ liệu (có thể lưu cache).</li>
<li><a href=https://redux-toolkit.js.org/rtk-query/usage/mutations>Mutation</a>: Dùng để cập nhật dữ liệu (validate cache).</li>
</ul>
<p>Với request login thì mình sẽ dùng loại <em>mutation</em>, sửa lại phần <strong>endpoints</strong> của file <code>store/api.js</code>:</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-react data-lang=react><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>api</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createApi</span>({
  ...
  <span style=color:#a6e22e>endpoints</span><span style=color:#f92672>:</span> (<span style=color:#a6e22e>builder</span>) =&gt; ({
    <span style=color:#75715e>// Tạo 1 request dạng mutation
</span><span style=color:#75715e></span>    <span style=color:#a6e22e>login</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>builder</span>.<span style=color:#a6e22e>mutation</span>({
      <span style=color:#a6e22e>query</span><span style=color:#f92672>:</span> (<span style=color:#a6e22e>credentials</span>) =&gt; ({
        <span style=color:#a6e22e>url</span><span style=color:#f92672>:</span> <span style=color:#e6db74>`login`</span>,
        <span style=color:#a6e22e>method</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;POST&#39;</span>,
        <span style=color:#a6e22e>body</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>credentials</span>,
      }),
    }),

    <span style=color:#a6e22e>getUsers</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>builder</span>.<span style=color:#a6e22e>query</span>({
      <span style=color:#a6e22e>query</span><span style=color:#f92672>:</span> () =&gt; <span style=color:#e6db74>`users`</span>,
    }),
  }),
  ...
}

<span style=color:#75715e>// Export ra ngoài thành các hooks để sử dụng theo cú pháp use + endpoints (login) + endpoints type (mutation)
</span><span style=color:#75715e></span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>const</span> { <span style=color:#a6e22e>useLoginMutation</span> } <span style=color:#f92672>=</span> <span style=color:#a6e22e>api</span>;
</code></pre></td></tr></table>
</div>
</div><p>Sửa lại trang login, sử dụng mutation ở trên để gọi API:</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-react data-lang=react>...
<span style=color:#75715e>// Import hook để sử dụng
</span><span style=color:#75715e></span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>useLoginMutation</span> } <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;../store/api&#39;</span>;

<span style=color:#66d9ef>export</span> <span style=color:#66d9ef>default</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>Login</span>() {
  <span style=color:#75715e>// Sử dụng hook useLoginMutation sẽ trả về method login dùng để gọi request
</span><span style=color:#75715e></span>  <span style=color:#75715e>// kèm theo 1 số trạng thái như loading, dữ liệu hoặc lỗi trả về khi gọi request
</span><span style=color:#75715e></span>  <span style=color:#66d9ef>const</span> [<span style=color:#a6e22e>login</span>, { <span style=color:#a6e22e>isLoading</span>, <span style=color:#a6e22e>data</span>, <span style=color:#a6e22e>error</span> }] <span style=color:#f92672>=</span> <span style=color:#a6e22e>useLoginMutation</span>();
  ...
  <span style=color:#66d9ef>return</span> (
    &lt;&gt;
      ...
      {<span style=color:#75715e>/* Gọi login method lấy từ hook useLoginMutation() ở trên */</span>}
      {<span style=color:#75715e>/* Có thể sử dụng biến isLoading để hiển thị trạng thái loading thay cho state */</span>}
      &lt;<span style=color:#f92672>button</span> <span style=color:#a6e22e>onClick</span><span style=color:#f92672>=</span>{() =&gt; <span style=color:#a6e22e>login</span>({ <span style=color:#a6e22e>email</span>, <span style=color:#a6e22e>password</span> })} <span style=color:#a6e22e>disabled</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>isLoading</span>}&gt;
        <span style=color:#a6e22e>Login</span>
      &lt;/<span style=color:#f92672>button</span>&gt;
    &lt;/&gt;
  );
}
</code></pre></td></tr></table>
</div>
</div><p>Như vậy việc gọi API sẽ trở nên dễ dàng hơn. Bạn cũng có thể sử dụng biến <code>error</code> để hiển thị báo lỗi trên giao diện.</p>
<p>Trong trường hợp cần lưu dữ liệu vào trong store, ví dụ cập nhật state ở Slice khác thì làm tương tự như khi dùng <em>createAsyncThunk</em>. Sửa lại file <code>store/userSlice.js</code> để thêm logic lưu thông tin user sau khi user đăng nhập thành công:</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-react data-lang=react>  <span style=color:#a6e22e>extraReducers</span><span style=color:#f92672>:</span> (<span style=color:#a6e22e>builder</span>) =&gt; {
    <span style=color:#75715e>// Xử lý logic khi endpoint login được fulfilled
</span><span style=color:#75715e></span>    <span style=color:#a6e22e>builder</span>.<span style=color:#a6e22e>addMatcher</span>(<span style=color:#a6e22e>api</span>.<span style=color:#a6e22e>endpoints</span>.<span style=color:#a6e22e>login</span>.<span style=color:#a6e22e>matchFulfilled</span>, (<span style=color:#a6e22e>state</span>, <span style=color:#a6e22e>action</span>) =&gt; {
      <span style=color:#75715e>// Lưu thông tin user vào state
</span><span style=color:#75715e></span>      <span style=color:#a6e22e>state</span>.<span style=color:#a6e22e>currentUser</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>action</span>.<span style=color:#a6e22e>payload</span>;
    });
  },
</code></pre></td></tr></table>
</div>
</div><p>Hoặc RTK Query cũng hỗ trợ lấy state từ Slice khác. Ví dụ sau khi login thành công thì các request đến private API cần có gửi thêm token. Chúng ta có thể lấy token từ trong userSlice (state currentUser).</p>
<p>Sửa lại hàm <strong>fetchBaseQuery()</strong> ở <code>store/api.js</code> để cho phép các request đều gửi kèm token nếu có:</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-react data-lang=react>  <span style=color:#a6e22e>baseQuery</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>fetchBaseQuery</span>({
    <span style=color:#a6e22e>baseUrl</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;https://fake-rest-api-nodejs.herokuapp.com/&#39;</span>,

    <span style=color:#75715e>// Xử lý header trước khi gửi request
</span><span style=color:#75715e></span>    <span style=color:#a6e22e>prepareHeaders</span><span style=color:#f92672>:</span> (<span style=color:#a6e22e>headers</span>, { <span style=color:#a6e22e>getState</span> }) =&gt; {
      <span style=color:#75715e>// getState() giúp lấy ra toàn bộ state trong store
</span><span style=color:#75715e></span>            <span style=color:#75715e>// getState().user lấy ra state trong userSlice
</span><span style=color:#75715e></span>      <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>token</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>getState</span>().<span style=color:#a6e22e>user</span>.<span style=color:#a6e22e>currentUser</span><span style=color:#f92672>?</span>.<span style=color:#a6e22e>token</span>;

      <span style=color:#75715e>// Nếu có token thì thêm vào headers
</span><span style=color:#75715e></span>      <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>token</span>) {
        <span style=color:#a6e22e>headers</span>.<span style=color:#a6e22e>set</span>(<span style=color:#e6db74>&#39;Authorization&#39;</span>, <span style=color:#e6db74>`Bearer </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>token</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>);
      }

      <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>headers</span>;
    },
  }),
</code></pre></td></tr></table>
</div>
</div><p>Kiểm tra thử bằng cách tạo thêm 1 endpoint nữa để lấy ra danh sách user. Endpoint này là private và nếu không có token sẽ trả về lỗi 401. Bổ sung thêm endpoint <code>getUsers</code> vào file <code>store/api.js</code>:</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style=display:block;width:100%;background-color:#3c3d38><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span></span><span style=display:block;width:100%;background-color:#3c3d38><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span></span><span style=display:block;width:100%;background-color:#3c3d38><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span></span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-react data-lang=react><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>api</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createApi</span>({
  ...
  <span style=color:#a6e22e>endpoints</span><span style=color:#f92672>:</span> (<span style=color:#a6e22e>builder</span>) =&gt; ({
    <span style=color:#a6e22e>login</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>builder</span>.<span style=color:#a6e22e>mutation</span>(...),

    <span style=color:#75715e>// Thêm endpoint dạng query
</span><span style=display:block;width:100%;background-color:#3c3d38><span style=color:#75715e></span>    <span style=color:#a6e22e>getUsers</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>builder</span>.<span style=color:#a6e22e>query</span>({
</span><span style=display:block;width:100%;background-color:#3c3d38>      <span style=color:#a6e22e>query</span><span style=color:#f92672>:</span> () =&gt; <span style=color:#e6db74>`users`</span>,
</span><span style=display:block;width:100%;background-color:#3c3d38>    }),
</span>  }),
  ...
}

<span style=color:#75715e>// Export các hooks ra ngoài để sử dụng
</span><span style=color:#75715e></span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>const</span> { <span style=color:#a6e22e>useLoginMutation</span>, <span style=color:#a6e22e>useGetUsersQuery</span> } <span style=color:#f92672>=</span> <span style=color:#a6e22e>api</span>;
</code></pre></td></tr></table>
</div>
</div><p>Sửa lại nội dung trang <code>Dashboard</code> (sau khi login thành công) để hiển thị thông tin users lấy từ API:</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-react data-lang=react>...
<span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>useGetUsersQuery</span> } <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;../store/api&#39;</span>;

<span style=color:#66d9ef>export</span> <span style=color:#66d9ef>default</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>Dashboard</span>() {
  <span style=color:#75715e>// Sử dụng hook useGetUsersQuery để gọi API
</span><span style=color:#75715e></span>  <span style=color:#66d9ef>const</span> { <span style=color:#a6e22e>data</span>, <span style=color:#a6e22e>isLoading</span>, <span style=color:#a6e22e>error</span> } <span style=color:#f92672>=</span> <span style=color:#a6e22e>useGetUsersQuery</span>();

  ...

  <span style=color:#66d9ef>return</span> (
    &lt;&gt;
      ...

      &lt;<span style=color:#f92672>h2</span>&gt;<span style=color:#a6e22e>User</span> <span style=color:#a6e22e>List</span>&lt;/<span style=color:#f92672>h2</span>&gt;

      {<span style=color:#a6e22e>isLoading</span> <span style=color:#f92672>?</span> (
        <span style=color:#e6db74>&#39;fetching data ...&#39;</span>
      ) <span style=color:#f92672>:</span> (
        &lt;<span style=color:#f92672>ul</span>&gt;
          {<span style=color:#a6e22e>data</span><span style=color:#f92672>?</span>.<span style=color:#a6e22e>map</span>((<span style=color:#a6e22e>item</span>) =&gt; (
            &lt;<span style=color:#f92672>li</span> <span style=color:#a6e22e>key</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>item</span>.<span style=color:#a6e22e>id</span>}&gt;
              {<span style=color:#a6e22e>item</span>.<span style=color:#a6e22e>firstName</span>} {<span style=color:#a6e22e>item</span>.<span style=color:#a6e22e>lastName</span>}
            &lt;/<span style=color:#f92672>li</span>&gt;
          ))}
        &lt;/<span style=color:#f92672>ul</span>&gt;
      )}
    &lt;/&gt;
  );
}
</code></pre></td></tr></table>
</div>
</div><p>Vậy là chúng ta đã làm xong một ứng dụng nhỏ sử dụng RTK Query cho việc fetching data. Addon này còn nhiều chức năng nữa như caching, prefetching, polling, code splitting, &mldr; các bạn hãy đọc thêm document trên trang chủ của thư viện để áp dụng vào dự án.</p>
<p>Tham khảo toàn bộ code mẫu tại đây: <a href="https://stackblitz.com/edit/react-router-redux-toolkit-fetch-api-2c64iz?file=src/App.js">https://stackblitz.com/edit/react-router-redux-toolkit-fetch-api-2c64iz?file=src/App.js</a>.</p>
<p>Happy coding 😎</p>
</div>
<footer class=post-footer>
<ul class=post-tags>
<li><a href=https://huydq.dev/tags/reactjs/>ReactJS</a></li>
<li><a href=https://huydq.dev/tags/redux-toolkit/>Redux Toolkit</a></li>
</ul>
<nav class=paginav>
<a class=prev href=https://huydq.dev/blog/tao-hieu-ung-transition-cho-react-app-voi-react-transition-group/>
<span class=title>« Prev</span>
<br>
<span>Tạo hiệu ứng transition cho React App với React Transition Group</span>
</a>
<a class=next href=https://huydq.dev/blog/huong-dan-su-dung-createasyncthunk-trong-redux-toolkit/>
<span class=title>Next »</span>
<br>
<span>Hướng dẫn sử dụng createAsyncThunk trong Redux Toolkit</span>
</a>
</nav>
<div class=share-buttons>
<a target=_blank rel="noopener noreferrer" aria-label="share Hướng dẫn sử dụng RTK Query trong Redux Toolkit on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fhuydq.dev%2fblog%2fhuong-dan-su-dung-rtk-query-trong-redux-toolkit%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share Hướng dẫn sử dụng RTK Query trong Redux Toolkit on twitter" href="https://twitter.com/intent/tweet/?text=H%c6%b0%e1%bb%9bng%20d%e1%ba%abn%20s%e1%bb%ad%20d%e1%bb%a5ng%20RTK%20Query%20trong%20Redux%20Toolkit&url=https%3a%2f%2fhuydq.dev%2fblog%2fhuong-dan-su-dung-rtk-query-trong-redux-toolkit%2f&hashtags=ReactJS%2cReduxToolkit"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg>
</a>
</div>
</footer><div id=disqus_thread></div>
<script type=text/javascript>(function(){if(window.location.hostname=="localhost")return;var a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src="//huydq-dev.disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)})()</script>
<noscript>Please enable JavaScript to view the
<a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript>
</article>
</main>
<footer class=footer>
<span>&copy; 2022 HuyDQ's Blog</span>
<span>&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;</span>
<div class=social-icons>
<a href=https://github.com/robinhuy><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg>
</a>
<a href=https://codepen.io/robinhuy><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="12 2 22 8.5 22 15.5 12 22 2 15.5 2 8.5 12 2"/><line x1="12" y1="22" x2="12" y2="15.5"/><polyline points="22 8.5 12 15.5 2 8.5"/><polyline points="2 15.5 12 8.5 22 15.5"/><line x1="12" y1="2" x2="12" y2="8.5"/></svg>
</a>
<a href=https://stackoverflow.com/users/5229299/robin-huy><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2.913 16.041v6.848h17.599v-6.848M7.16 18.696h8.925M7.65 13.937l8.675 1.8M9.214 9.124l8.058 3.758M12.086 4.65l6.849 5.66M15.774 1.111l5.313 7.162"/></svg>
</a>
</div>
</footer>
<a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a>
<script>let menu=document.getElementById('menu');menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script>
<script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script>
<script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script>
<script>document.querySelectorAll('pre > code').forEach(b=>{const c=b.parentNode.parentNode,a=document.createElement('button');a.classList.add('copy-code'),a.innerHTML='copy';function d(){a.innerHTML='copied!',setTimeout(()=>{a.innerHTML='copy'},2e3)}a.addEventListener('click',e=>{if('clipboard'in navigator){navigator.clipboard.writeText(b.textContent),d();return}const a=document.createRange();a.selectNodeContents(b);const c=window.getSelection();c.removeAllRanges(),c.addRange(a);try{document.execCommand('copy'),d()}catch(a){}c.removeRange(a)}),c.classList.contains("highlight")?c.appendChild(a):c.parentNode.firstChild==c||(b.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?b.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(a):b.parentNode.appendChild(a))})</script>
</body>
</html>